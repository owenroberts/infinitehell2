class Player extends Sprite{constructor(e,t,i,s){super(e,t),this.mapPosition=[Math.round(e),Math.round(t)],this.center=!0,this.debug=s||!1,this.speed=[1,1],this.jumpSpeed=-20,this.jumpJustPressed=!1,this.isJumping=!1,this.jumpCount=0,this.jumpMax=2,this.addAnimation(i),this.animation.state="idle",this.input={right:!1,up:!1,left:!1,down:!1,jump:!1},this.inBounds=[!0,!0],this.hasSFX=!1,this.setupPhysics(),this.halfWidth=this.width/2,this.halfHeight=this.height/2}setupPhysics(){let e=[];this.blocked={down:null,up:null,right:null,left:null},this.sensors={};let[t,i]=this.position,[s,n]=[90,78];this.sensors.down=Bodies.rectangle(t,i+n/2,this.width/2,10,{isSensor:!0}),e.push(this.sensors.down),e.push(Bodies.rectangle(t,i,s,n));const o={inertia:1/0,restitution:.1,friction:.5,parts:e};this.body=Body.create(o),this.body.isPlayer=!0,Composite.add(engine.world,this.body),console.log(this.body),Events.on(engine,"afterUpdate",this.physicsUpdate.bind(this)),Events.on(engine,"beforeUpdate",(e=>{this.blocked.down=!1}));let a=!0;Events.on(engine,"collisionActive",(e=>{let t=e.pairs;a&&(a=!1);for(let e=0,i=t.length;e<i;e++){let i=t[e];i.bodyA!==this.sensors.down&&i.bodyB!==this.sensors.down||(this.blocked.down=!0),i.bodyA.isTrigger&&i.bodyB.parent.isPlayer&&(i.bodyA.calledBack||(i.bodyA.callback(),i.bodyA.calledBack=!0)),i.bodyB.isTrigger&&i.bodyA.parent.isPlayer&&(i.bodyB.calledBack||(i.bodyB.callback(),i.bodyB.calledBack=!0)),i.bodyA.calledBack&&Composite.remove(engine.world,i.bodyA),i.bodyB.calledBack&&Composite.remove(engine.world,i.bodyB)}}))}inputKey(e,t){this.input[e]=t}translatePosition(){return[-this.x-this.halfWidth,-this.y-this.halfHeight]}physicsUpdate(){let e=this.animation.stateName.includes("idle")?this.animation.state:"idle";this.blocked.down&&this.isJumping&&(this.isJumping=!1,this.jumpCount=0),this.input.jump?(this.jumpJustPressed||(this.blocked.down||this.jumpCount<this.jumpMax)&&(Body.setVelocity(this.body,{x:this.body.velocity.x,y:-10}),this.isJumping=!0,this.jumpCount++),this.jumpJustPressed=!0):this.jumpJustPressed=!1,!this.isJumping&&this.blocked.down||(e="jump"),this.input.right&&(this.isJumping||(e="right"),Body.setVelocity(player.body,{x:3,y:player.body.velocity.y})),this.input.left&&(this.isJumping||(e="left"),Body.setVelocity(player.body,{x:-3,y:player.body.velocity.y})),this.position[0]=Math.round(this.body.position.x),this.position[1]=Math.round(this.body.position.y),this.animation.state=e,this.hasSFX&&this.playSFX(speed)}display(){super.display(!0)}}const title=document.getElementById("title");function loadingAnimation(){let e="~"+title.textContent+"~";title.textContent=e}let loadingInterval=setInterval(loadingAnimation,1e3/12);const isMobile=Cool.mobilecheck();isMobile&&document.body.classList.add("mobile");const gme=new Game({dps:24,lineWidth:1,zoom:1,width:window.innerWidth,height:window.innerHeight,multiColor:!0,checkRetina:!0,suspend:!0,events:isMobile?["touch"]:["keyboard","mouse"],scenes:["game","splash","loading"],bounds:{left:-1024,top:1024,right:1024,bottom:1024}});let player;gme.load({sprites:"data/sprites.json"},!1);const{Engine:Engine,Bodies:Bodies,Body:Body,Composite:Composite,Runner:Runner,Events:Events}=Matter,showPhysics=!0,engine=Engine.create();engine.gravity.y=2;const objects=[],defaultOptions={restitution:.5,friction:.9};function addBody(e,t,i){const s=Bodies.rectangle(Math.round(e),Math.round(t),i,i,{...defaultOptions,isStatic:!0}),n=new Sprite(e,t,gme.anims.sprites.test_tile);return n.center=!0,gme.scenes.game.addSprite(n),Composite.add(engine.world,s),s}function addTrigger(e,t,i,s,n){const o=Bodies.rectangle(Math.round(e),Math.round(t),i,s,{isStatic:!0,isSensor:!0});return o.isTrigger=!0,o.callback=n,Composite.add(engine.world,o),o}gme.start=function(){document.getElementById("splash").remove(),player=new Player(0,0,gme.anims.sprites.player),gme.scenes.game.addSprite(player);gme.view.halfWidth;const e=gme.view.halfHeight;addBody(0,e+100,100),addBody(150,e+100,100),addBody(300,e+100,100),addBody(150,e+1e3,100),addBody(300,e+1e3,100),addBody(450,e+1e3,100),addBody(600,e+1e3,100),addBody(750,e+1e3,100),addBody(150,e+1e3,100),addBody(300,e+1e3,100),addBody(450,e+1e3,100),addBody(600,e+1e3,100),addBody(750,e+1e3,100),addTrigger(-gme.halfWidth/2,e+300,2.5*gme.width,200,(function(){lerpCenter=[...cameraCenter],startLerp=!0})),gme.scenes.current="game",Runner.run(engine)},gme.draw=function(){gme.ctx.save(),camera(),gme.scenes.current.display(!0),renderDebug(),gme.ctx.restore()};let centerPlayer=!1,cameraCenter=[100,0],lerpCenter=[0,0],startLerp=!1,lerpSpeed=8,lerpThreshold=.1;function camera(){if(startLerp){let e=gme.halfWidth-player.x-player.halfWidth,t=gme.halfHeight-player.y-player.halfHeight,i=[e-lerpCenter[0],t-lerpCenter[1]];lerpCenter[0]+=i[0]/lerpSpeed,lerpCenter[1]+=i[1]/lerpSpeed,gme.ctx.translate(lerpCenter[0],lerpCenter[1]),(Math.abs(i[0])<lerpThreshold||Math.abs(i[1])<lerpThreshold)&&(startLerp=!1,centerPlayer=!0)}else centerPlayer?gme.ctx.translate(gme.halfWidth-player.x-player.halfWidth,gme.halfHeight-player.y-player.halfHeight):gme.ctx.translate(cameraCenter[0],cameraCenter[1])}function renderDebug(){gme.ctx.beginPath(),gme.ctx.strokeStyle="#ffffff",gme.ctx.arc(0,0,5,0,2*Math.PI),gme.ctx.stroke()}function renderPhysics(){let e=gme.ctx.lineWidth,t=gme.ctx.strokeStyle;gme.ctx.clearRect(0,0,gme.view.width,gme.view.height),gme.ctx.lineWidth=1,gme.ctx.strokeStyle="#00dd22";const i=Composite.allBodies(engine.world);for(let e=0,t=i.length;e<t;e++){const t=i[e];gme.ctx.beginPath();for(let e=0,i=t.parts.length;e<i;e++){const i=t.parts[e];gme.ctx.moveTo(i.vertices[0].x,i.vertices[0].y);for(let e=1,t=i.vertices.length;e<t;e++)gme.ctx.lineTo(i.vertices[e].x,i.vertices[e].y);gme.ctx.lineTo(i.vertices[0].x,i.vertices[0].y)}gme.ctx.stroke()}gme.ctx.lineWidth=e,gme.ctx.strokeStyle=t}gme.keyDown=function(e){switch(e){case"a":case"left":player.inputKey("left",!0);break;case"w":case"up":case"x":case"space":player.inputKey("jump",!0);break;case"d":case"right":player.inputKey("right",!0)}},gme.keyUp=function(e){switch(e){case"a":case"left":player.inputKey("left",!1);break;case"w":case"up":case"x":case"space":player.inputKey("jump",!1);break;case"d":case"right":player.inputKey("right",!1);break;case"s":case"down":player.inputKey("down",!1)}};
//# sourceMappingURL=src_maps/gme.min.js.map
