class Player extends Sprite{constructor(e,t,i,s){super(e,t),this.mapPosition=[Math.round(e),Math.round(t)],this.center=!0,this.debug=s||!1,this.speed=[1,1],this.jumpSpeed=-20,this.jumpJustPressed=!1,this.isJumping=!1,this.jumpCount=0,this.jumpMax=2,this.addAnimation(i),this.animation.state="idle",this.input={right:!1,up:!1,left:!1,down:!1,jump:!1},this.inBounds=[!0,!0],this.hasSFX=!1,this.setupPhyiscs()}setupPhyiscs(){let e=[];this.blocked={down:null,up:null,right:null,left:null},this.sensors={};let{x:t,y:i}=this,[s,n]=[90,78];this.sensors.down=Bodies.rectangle(t,i+n/2,this.width/2,10,{isSensor:!0}),e.push(this.sensors.down),e.push(Bodies.rectangle(t,i,s,n));const o={inertia:1/0,restitution:.1,friction:.5,parts:e};this.body=Body.create(o),Composite.add(engine.world,this.body),Events.on(engine,"afterUpdate",this.physicsUpdate.bind(this)),Events.on(engine,"beforeUpdate",(e=>{this.blocked.down=!1})),Matter.Events.on(engine,"collisionActive",(e=>{let t=e.pairs;for(let e=0,i=t.length;e<i;e++){let i=t[e];i.bodyA!==this.sensors.down&&i.bodyB!==this.sensors.down||(this.blocked.down=!0)}}))}inputKey(e,t){this.input[e]=t}physicsUpdate(){let e=this.animation.stateName.includes("idle")?this.animation.state:"idle";this.input.jump?(this.jumpJustPressed||(this.blocked.down||this.jumpCount<this.jumpMax)&&(Body.setVelocity(this.body,{x:this.body.velocity.x,y:-10}),this.isJumping=!0,this.jumpCount++),this.jumpJustPressed=!0):this.jumpJustPressed=!1,this.blocked.down&&this.isJumping&&!this.jumpJustPressed&&(this.isJumping=!1,this.jumpCount=0),!this.isJumping&&this.blocked.down||(e="jump"),this.input.right&&(this.isJumping||(e="right"),Body.setVelocity(player.body,{x:3,y:player.body.velocity.y})),this.input.left&&(this.isJumping||(e="left"),Body.setVelocity(player.body,{x:-3,y:player.body.velocity.y})),this.position[0]=this.body.position.x,this.position[1]=this.body.position.y,this.animation.state=e,this.hasSFX&&this.playSFX(speed)}}const title=document.getElementById("title");function loadingAnimation(){let e="~"+title.textContent+"~";title.textContent=e}let loadingInterval=setInterval(loadingAnimation,1e3/12);const isMobile=Cool.mobilecheck();isMobile&&document.body.classList.add("mobile");const gme=new Game({dps:24,lineWidth:1,zoom:1,width:window.innerWidth,height:window.innerHeight,multiColor:!0,checkRetina:!0,suspend:!0,events:isMobile?["touch"]:["keyboard","mouse"],scenes:["game","splash","loading"],bounds:{left:-1024,top:1024,right:1024,bottom:1024}});let player;gme.load({sprites:"data/sprites.json"},!1);const{Engine:Engine,Bodies:Bodies,Body:Body,Composite:Composite,Runner:Runner,Events:Events}=Matter,showPhysics=!0,engine=Engine.create();engine.gravity.y=2;const objects=[],defaultOptions={restitution:.5,friction:.9};function addBody(e,t,i){const s=Bodies.rectangle(Math.round(e),Math.round(t),i,i,{...defaultOptions,isStatic:!0});return Composite.add(engine.world,s),s}function renderPhysics(){let e=gme.ctx.lineWidth,t=gme.ctx.strokeStyle;gme.ctx.clearRect(0,0,gme.view.width,gme.view.height),gme.ctx.lineWidth=1,gme.ctx.strokeStyle="#00dd22",gme.ctx.beginPath();const i=Composite.allBodies(engine.world);for(let e=0,t=i.length;e<t;e++){const t=i[e];for(let e=0,i=t.parts.length;e<i;e++){const i=t.parts[e];gme.ctx.moveTo(i.vertices[0].x,i.vertices[0].y);for(let e=1,t=i.vertices.length;e<t;e++)gme.ctx.lineTo(i.vertices[e].x,i.vertices[e].y);gme.ctx.lineTo(i.vertices[0].x,i.vertices[0].y)}}gme.ctx.stroke(),gme.ctx.lineWidth=e,gme.ctx.strokeStyle=t}gme.start=function(){document.getElementById("splash").remove(),player=new Player(gme.view.halfWidth,gme.view.halfHeight,gme.anims.sprites.player),gme.scenes.game.addSprite(player);gme.view.halfWidth;const e=gme.view.halfHeight;addBody(0,e+100,100),addBody(150,e+100,100),addBody(300,e+100,100),addBody(450,e+100,100),addBody(600,e+100,100),addBody(750,e+100,100),gme.scenes.current="game",Runner.run(engine)},gme.update=function(e){for(let e=0;e<objects.length;e++);},gme.draw=function(){renderPhysics(),gme.scenes.current.display()},gme.keyDown=function(e){switch(e){case"a":case"left":player.inputKey("left",!0);break;case"w":case"up":player.inputKey("up",!0);break;case"d":case"right":player.inputKey("right",!0);break;case"s":case"down":player.inputKey("down",!0);break;case"x":player.inputKey("jump",!0)}},gme.keyUp=function(e){switch(e){case"a":case"left":player.inputKey("left",!1);break;case"w":case"up":player.inputKey("up",!1);break;case"d":case"right":player.inputKey("right",!1);break;case"s":case"down":player.inputKey("down",!1);break;case"x":player.inputKey("jump",!1)}};
//# sourceMappingURL=src_maps/gme.min.js.map
